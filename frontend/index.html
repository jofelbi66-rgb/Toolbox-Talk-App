<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Toolbox Talk</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 16px; background: #f6f6f6; }
    .card { background: #fff; border: 1px solid #ddd; border-radius: 12px; padding: 16px; max-width: 720px; margin: 0 auto; }
    h1 { font-size: 18px; margin: 0 0 12px 0; }
    label { display:block; font-size: 12px; color:#333; margin-top: 12px; }
    input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ccc; font-size: 16px; }
    button { width: 100%; margin-top: 12px; padding: 14px; border: 0; border-radius: 12px; font-size: 16px; }
    .btn { background: #1a73e8; color: #fff; }
    .btn2 { background: #e8eaed; color: #111; }
    .row { margin-top: 12px; }
    .list { margin-top: 12px; }
    .item { display:flex; justify-content:space-between; gap:12px; padding: 12px; border: 1px solid #ddd; border-radius: 12px; background:#fff; margin-bottom:10px; }
    .name { font-weight: 700; }
    .company { color:#666; font-size: 12px; margin-top: 2px; }
    .status { font-size: 12px; color:#666; }
    .ok { color: #137333; font-weight:700; }
    .err { color: #b00020; font-weight:700; }
    .small { font-size: 12px; color:#666; }
  </style>
</head>

<body>
  <div class="card">
    <h1>Toolbox Talk – Dokumentation</h1>
<div class="small">
  Schritt 1: Stammdaten erfassen. Schritt 2: Teilnehmer auswählen. (Unterschriften + PDF kommen als nächstes.)
</div>

<label for="dateTime">Datum/Uhrzeit</label>
<input id="dateTime" type="datetime-local" />

<label for="site">Ort</label>
<input id="site" placeholder="z. B. Baustelle Köln" />

<label for="project">Projekt</label>
<input id="project" placeholder="z. B. Brücke Nord" />

<label for="topic">Thema</label>
<input id="topic" placeholder="z. B. Leitern & Tritte" />

<label for="trainer">Moderator</label>
<input id="trainer" placeholder="Name" />

<label for="summary">Kernaussagen</label>
<textarea id="summary" rows="5" style="width:100%;padding:12px;border-radius:10px;border:1px solid #ccc;font-size:16px;"></textarea>

<hr style="margin:16px 0;border:none;border-top:1px solid #eee;" />

<label for="apiUrl">Apps Script Web-App URL</label>
<input id="apiUrl" placeholder="https://script.googleusercontent.com/...." />



<div class="row">
  <div id="result" class="status">Noch nichts geladen.</div>
</div>

    <button class="btn" id="loadBtn">Teilnehmer laden</button>
    <button class="btn2" id="saveBtn">URL speichern</button>

    <div class="row">
      <div id="result" class="status">Noch nichts geladen.</div>
    </div>

    <div class="list" id="list"></div>
  </div>

  <script>
    const apiUrlInput = document.getElementById("apiUrl");
    const loadBtn = document.getElementById("loadBtn");
    const saveBtn = document.getElementById("saveBtn");
    const result = document.getElementById("result");
    const list = document.getElementById("list");

    // gespeicherte URL laden
    apiUrlInput.value = localStorage.getItem("TT_API_URL") || "";

    saveBtn.addEventListener("click", () => {
      localStorage.setItem("TT_API_URL", apiUrlInput.value.trim());
      result.innerHTML = '<span class="ok">Gespeichert.</span>';
    });

    loadBtn.addEventListener("click", async () => {
      const base = apiUrlInput.value.trim();
      if (!base) {
        result.innerHTML = '<span class="err">Bitte Web-App URL eintragen.</span>';
        return;
      }

      const url = base.includes("?") ? base + "&route=participants" : base + "?route=participants";

      result.textContent = "Lade…";
      list.innerHTML = "";

      try {
        const res = await fetch(url, { method: "GET" });
        const data = await res.json();

        if (!data.ok) {
          result.innerHTML = '<span class="err">Fehler: ' + (data.error || "unbekannt") + '</span>';
          return;
        }

        result.innerHTML = '<span class="ok">OK:</span> ' + data.participants.length + " Teilnehmer geladen.";

        data.participants.forEach(p => {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `
            <div>
              <div class="name">${escapeHtml(p.name)}</div>
              <div class="company">${escapeHtml(p.company)}</div>
            </div>
            <div class="status">${escapeHtml(p.participantId)}</div>
          `;
          list.appendChild(div);
        });

      } catch (e) {
        result.innerHTML = '<span class="err">Netz/JSON Fehler: </span>' + escapeHtml(String(e));
      }
    });

    function escapeHtml(s) {
      return String(s || "").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }
  </script>
</body>
</html>
